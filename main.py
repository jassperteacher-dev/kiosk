import streamlit as st

# ---------------------------------------------------------
# 1. ë°ì´í„° ì¤€ë¹„ (ì¬ë£Œ ì†ì§ˆ)
# ---------------------------------------------------------
# í•™ìƒì´ ë§Œë“  ë”•ì…”ë„ˆë¦¬ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.
# (ë‚˜ì¤‘ì—ëŠ” ì—‘ì…€ì´ë‚˜ DBì—ì„œ ê°€ì ¸ì˜¤ê²Œ ë˜ì§€ë§Œ, ì§€ê¸ˆì€ í•˜ë“œì½”ë”©ì´ í•™ìŠµì— ì¢‹ìŠµë‹ˆë‹¤)
menu_data = {
    "ì‹ì‚¬ë¥˜": {
        "ìˆœëŒ€êµ­ë°¥": 10000,
        "ë‚´ì¥êµ­ë°¥": 10000,
        "ì–¼í°êµ­ë°¥": 11000,
        "ê³ ê¸°ë§Œ": 10000
    },
    "ì•ˆì£¼ë¥˜": {
        "ëª¨ë‘ ìˆœëŒ€": 15000,
        "ë¨¸ë¦¬ê³ ê¸°": 18000,
        "ìˆ êµ­": 15000
    },
    "ìŒë£Œ/ì£¼ë¥˜": {
        "ì½œë¼": 2000,
        "ì‚¬ì´ë‹¤": 2000,
        "ì†Œì£¼": 5000,
        "ë§¥ì£¼": 5000
    }
}

# ---------------------------------------------------------
# 2. ê¸°ì–µ ì¥ì¹˜ ë§Œë“¤ê¸° (Session State)
# ---------------------------------------------------------
# ì¤‘ìš”: Streamlitì€ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ í™”ë©´ì´ ìƒˆë¡œê³ ì¹¨ ë©ë‹ˆë‹¤.
# ì¥ë°”êµ¬ë‹ˆê°€ ì§€ì›Œì§€ì§€ ì•Šê²Œ 'session_state'ë¼ëŠ” ê¸ˆê³ ì— ë„£ì–´ë‘¬ì•¼ í•©ë‹ˆë‹¤.
if 'cart' not in st.session_state:
    st.session_state['cart'] = []  # ì¥ë°”êµ¬ë‹ˆ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”

# ---------------------------------------------------------
# 3. í™”ë©´ ë ˆì´ì•„ì›ƒ ì¡ê¸° (UI)
# ---------------------------------------------------------
st.set_page_config(layout="wide") # í™”ë©´ ë„“ê²Œ ì“°ê¸°
st.title("ğŸš ì½”ë”©êµ­ë°¥ í‚¤ì˜¤ìŠ¤í¬")

# í™”ë©´ì„ ì™¼ìª½(ë©”ë‰´íŒ)ê³¼ ì˜¤ë¥¸ìª½(ì¥ë°”êµ¬ë‹ˆ)ìœ¼ë¡œ 7:3 ë¹„ìœ¨ë¡œ ë‚˜ëˆ•ë‹ˆë‹¤.
col_menu, col_cart = st.columns([0.7, 0.3])

# === [ì™¼ìª½ êµ¬ì—­] ë©”ë‰´íŒ ===
with col_menu:
    # íƒ­ì„ ë§Œë“¤ì–´ì„œ ì¹´í…Œê³ ë¦¬ë¥¼ êµ¬ë¶„í•©ë‹ˆë‹¤.
    tab1, tab2, tab3 = st.tabs(["ğŸ¥˜ ì‹ì‚¬ë¥˜", "ğŸ– ì•ˆì£¼ë¥˜", "ğŸ¥¤ ìŒë£Œ/ì£¼ë¥˜"])

    # í•¨ìˆ˜: ë©”ë‰´ ë²„íŠ¼ì„ ë§Œë“¤ì–´ì£¼ëŠ” ê¸°ê³„
    def show_menu_buttons(category_name):
        # ì„ íƒí•œ ì¹´í…Œê³ ë¦¬ì˜ ë©”ë‰´ë“¤ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
        current_menu = menu_data[category_name]
        
        # ë³´ê¸° ì¢‹ê²Œ 3ë‹¨ìœ¼ë¡œ ë°°ì—´í•©ë‹ˆë‹¤.
        cols = st.columns(3)
        
        # ë©”ë‰´íŒ ë”•ì…”ë„ˆë¦¬ì—ì„œ í•˜ë‚˜ì”© êº¼ë‚´ì„œ ë²„íŠ¼ ë§Œë“¤ê¸°
        # index(ìˆœì„œ), key(ì´ë¦„), value(ê°€ê²©)
        for i, (name, price) in enumerate(current_menu.items()):
            # 0, 1, 2ë²ˆ ì»¬ëŸ¼ì„ ìˆœì„œëŒ€ë¡œ ëŒì•„ê°€ë©° ë°°ì¹˜
            with cols[i % 3]: 
                st.markdown(f"### {name}") # ë©”ë‰´ ì´ë¦„ í¬ê²Œ
                st.write(f"ğŸ’° {price:,}ì›") # ê°€ê²© í‘œì‹œ
                
                # ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸°
                if st.button("ë‹´ê¸°", key=f"{category_name}_{name}"):
                    st.session_state['cart'].append({"name": name, "price": price})
                    st.toast(f"âœ… {name} ì¶”ê°€ë¨!") # ì•Œë¦¼ ë©”ì‹œì§€

    # ê° íƒ­ì— ë©”ë‰´ ë°°ì¹˜í•˜ê¸°
    with tab1:
        show_menu_buttons("ì‹ì‚¬ë¥˜")
    with tab2:
        show_menu_buttons("ì•ˆì£¼ë¥˜")
    with tab3:
        show_menu_buttons("ìŒë£Œ/ì£¼ë¥˜")

# === [ì˜¤ë¥¸ìª½ êµ¬ì—­] ì¥ë°”êµ¬ë‹ˆ & ì˜ìˆ˜ì¦ ===
with col_cart:
    st.markdown("## ğŸ›’ ì£¼ë¬¸ ë‚´ì—­")
    st.markdown("---")

    if len(st.session_state['cart']) == 0:
        st.info("ë©”ë‰´ë¥¼ ë‹´ì•„ì£¼ì„¸ìš”.")
    else:
        total_price = 0
        
        # ì¥ë°”êµ¬ë‹ˆ ë¦¬ìŠ¤íŠ¸ë¥¼ ë°˜ë³µë¬¸ìœ¼ë¡œ ì¶œë ¥
        for index, item in enumerate(st.session_state['cart']):
            st.write(f"{index+1}. {item['name']} ({item['price']:,}ì›)")
            total_price += item['price'] # ê°€ê²© ëˆ„ì  (sum ê¸°ëŠ¥)
        
        st.markdown("---")
        st.metric(label="ì´ ê²°ì œ ê¸ˆì•¡", value=f"{total_price:,}ì›")
        
        # ë²„íŠ¼ 2ê°œ (ì£¼ë¬¸í•˜ê¸°, ì´ˆê¸°í™”)
        col_btn1, col_btn2 = st.columns(2)
        
        with col_btn1:
            if st.button("ğŸ’³ ê²°ì œí•˜ê¸°", type="primary"):
                st.balloons() # í’ì„  íš¨ê³¼
                st.success(f"{total_price:,}ì› ê²°ì œ ì™„ë£Œ!")
                st.session_state['cart'] = [] # ì¥ë°”êµ¬ë‹ˆ ë¹„ìš°ê¸°
                st.rerun() # í™”ë©´ ìƒˆë¡œê³ ì¹¨
        
        with col_btn2:
            if st.button("ğŸ—‘ï¸ ì „ì²´ ì·¨ì†Œ"):
                st.session_state['cart'] = []
                st.rerun()
